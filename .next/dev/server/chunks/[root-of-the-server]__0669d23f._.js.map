{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jayesh_naphade/.gemini/antigravity/scratch/ai_tutor_demo/app/api/transcript/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { YoutubeTranscript } from 'youtube-transcript';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const { url } = await req.json();\r\n\r\n        if (!url) {\r\n            return NextResponse.json({ error: 'URL is required' }, { status: 400 });\r\n        }\r\n\r\n        // Extract video ID from URL (Permissive Regex)\r\n        // Matches: youtube.com/watch?v=ID, youtu.be/ID, youtube.com/embed/ID, youtube.com/v/ID, youtube.com/shorts/ID\r\n        const videoIdMatch = url.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?|shorts)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/);\r\n        const videoId = videoIdMatch ? videoIdMatch[1] : null;\r\n\r\n        if (!videoId) {\r\n            return NextResponse.json({ error: 'Invalid YouTube URL' }, { status: 400 });\r\n        }\r\n\r\n        console.log(`Fetching transcript for video ID: ${videoId}`);\r\n\r\n        // Fallback for demo video\r\n        if (videoId === 'kqtD5dpn9C8') {\r\n            console.log('Using fallback transcript for demo video');\r\n            const filePath = path.join(process.cwd(), 'transcript_kqtD5dpn9C8.txt');\r\n            try {\r\n                if (fs.existsSync(filePath)) {\r\n                    const fallbackText = fs.readFileSync(filePath, 'utf8');\r\n                    return NextResponse.json({ transcript: fallbackText });\r\n                }\r\n            } catch (e) {\r\n                console.error('Error reading fallback transcript:', e);\r\n            }\r\n        }\r\n\r\n        try {\r\n            const transcriptItems = await YoutubeTranscript.fetchTranscript(videoId);\r\n\r\n            if (!transcriptItems || transcriptItems.length === 0) {\r\n                // Return explicit missing flag instead of error\r\n                return NextResponse.json({ transcript: null, transcriptMissing: true, warning: 'No transcript found' });\r\n            }\r\n\r\n            const transcriptText = transcriptItems.map(item => item.text).join(' ');\r\n            return NextResponse.json({ transcript: transcriptText });\r\n        } catch (transcriptError) {\r\n            console.error('Transcript fetch error:', transcriptError);\r\n            // Return explicit missing flag to trigger General Mode\r\n            return NextResponse.json({ transcript: null, transcriptMissing: true, warning: 'Captions disabled or unavailable' });\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error('API error:', error);\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,IAAI;QAE9B,IAAI,CAAC,KAAK;YACN,OAAO,uMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,+CAA+C;QAC/C,8GAA8G;QAC9G,MAAM,eAAe,IAAI,KAAK,CAAC;QAC/B,MAAM,UAAU,eAAe,YAAY,CAAC,EAAE,GAAG;QAEjD,IAAI,CAAC,SAAS;YACV,OAAO,uMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,QAAQ,GAAG,CAAC,CAAC,kCAAkC,EAAE,SAAS;QAE1D,0BAA0B;QAC1B,IAAI,YAAY,eAAe;YAC3B,QAAQ,GAAG,CAAC;YACZ,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;YAC1C,IAAI;gBACA,IAAI,wGAAE,CAAC,UAAU,CAAC,WAAW;oBACzB,MAAM,eAAe,wGAAE,CAAC,YAAY,CAAC,UAAU;oBAC/C,OAAO,uMAAY,CAAC,IAAI,CAAC;wBAAE,YAAY;oBAAa;gBACxD;YACJ,EAAE,OAAO,GAAG;gBACR,QAAQ,KAAK,CAAC,sCAAsC;YACxD;QACJ;QAEA,IAAI;YACA,MAAM,kBAAkB,MAAM,2PAAiB,CAAC,eAAe,CAAC;YAEhE,IAAI,CAAC,mBAAmB,gBAAgB,MAAM,KAAK,GAAG;gBAClD,gDAAgD;gBAChD,OAAO,uMAAY,CAAC,IAAI,CAAC;oBAAE,YAAY;oBAAM,mBAAmB;oBAAM,SAAS;gBAAsB;YACzG;YAEA,MAAM,iBAAiB,gBAAgB,GAAG,CAAC,CAAA,OAAQ,KAAK,IAAI,EAAE,IAAI,CAAC;YACnE,OAAO,uMAAY,CAAC,IAAI,CAAC;gBAAE,YAAY;YAAe;QAC1D,EAAE,OAAO,iBAAiB;YACtB,QAAQ,KAAK,CAAC,2BAA2B;YACzC,uDAAuD;YACvD,OAAO,uMAAY,CAAC,IAAI,CAAC;gBAAE,YAAY;gBAAM,mBAAmB;gBAAM,SAAS;YAAmC;QACtH;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,uMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}