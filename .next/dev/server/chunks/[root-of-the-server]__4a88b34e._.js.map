{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jayesh_naphade/.gemini/antigravity/scratch/ai_tutor_demo/app/api/tts/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\n// WAV Header Helper Function\r\nfunction createWavHeader(pcmLength: number, sampleRate: number = 24000, numChannels: number = 1, bitsPerSample: number = 16) {\r\n    const buffer = Buffer.alloc(44);\r\n    buffer.write('RIFF', 0);\r\n    buffer.writeUInt32LE(36 + pcmLength, 4);\r\n    buffer.write('WAVE', 8);\r\n    buffer.write('fmt ', 12);\r\n    buffer.writeUInt32LE(16, 16);\r\n    buffer.writeUInt16LE(1, 20);\r\n    buffer.writeUInt16LE(numChannels, 22);\r\n    buffer.writeUInt32LE(sampleRate, 24);\r\n    buffer.writeUInt32LE(sampleRate * numChannels * (bitsPerSample / 8), 28);\r\n    buffer.writeUInt16LE(numChannels * (bitsPerSample / 8), 32);\r\n    buffer.writeUInt16LE(bitsPerSample, 34);\r\n    buffer.write('data', 36);\r\n    buffer.writeUInt32LE(pcmLength, 40);\r\n    return buffer;\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    let text = '';\r\n    try {\r\n        const body = await req.json();\r\n        text = body.text;\r\n        if (!text) return NextResponse.json({ error: 'Text required' }, { status: 400 });\r\n\r\n        const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;\r\n        if (!apiKey) throw new Error('API Key missing');\r\n\r\n        const genAI = new GoogleGenerativeAI(apiKey);\r\n        const model = genAI.getGenerativeModel({ model: \"gemini-2.5-flash-preview-tts\" });\r\n\r\n        console.log(`[Gemini TTS] Requesting Umbriel voice for: \"${text.substring(0, 20)}...\"`);\r\n\r\n        const result = await model.generateContent({\r\n            contents: [{ role: \"user\", parts: [{ text }] }],\r\n            generationConfig: {\r\n                responseModalities: [\"AUDIO\"],\r\n                speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: \"Sadachbia\" } } }\r\n            } as any\r\n        });\r\n\r\n        const audioPart = result.response.candidates?.[0]?.content.parts.find((p: any) => p.inlineData);\r\n        if (audioPart?.inlineData?.data) {\r\n            const pcmData = Buffer.from(audioPart.inlineData.data, 'base64');\r\n            const wavBuffer = Buffer.concat([createWavHeader(pcmData.length), pcmData]);\r\n            console.log(`[Gemini TTS] Success!`);\r\n            return NextResponse.json({\r\n                audioContent: wavBuffer.toString('base64'),\r\n                metadata: { source: 'Gemini', voice: 'Sadachbia' }\r\n            });\r\n        }\r\n        throw new Error('No audio from Gemini');\r\n    } catch (error: any) {\r\n        console.error('[Gemini TTS] Error:', error.message);\r\n\r\n        // Fallback to Google Cloud TTS\r\n        // if (text) {\r\n        //     console.warn('[Gemini TTS] Failed, falling back to Google Cloud TTS (Neural2-C)');\r\n        //     try {\r\n        //         const client = new TextToSpeechClient({\r\n        //             keyFilename: \"C:\\\\Users\\\\jayesh_naphade\\\\Downloads\\\\jyoti-project-477506-882032744666.json\"\r\n        //         });\r\n\r\n        //         const request = {\r\n        //             input: { text },\r\n        //             voice: { languageCode: 'en-IN', name: 'en-IN-Neural2-C' },\r\n        //             audioConfig: { audioEncoding: 'MP3' },\r\n        //         } as any;\r\n\r\n        //         const [response] = await client.synthesizeSpeech(request);\r\n        //         const audioContent = response.audioContent?.toString('base64');\r\n\r\n        //         if (audioContent) {\r\n        //             console.log(`[Fallback TTS] Success!`);\r\n        //             return NextResponse.json({\r\n        //                 audioContent,\r\n        //                 metadata: { source: 'Google Cloud', voice: 'Neural2-C' }\r\n        //             });\r\n        //         }\r\n        //     } catch (fallbackError: any) {\r\n        //         console.error('[Fallback TTS] Error:', fallbackError.message);\r\n        //     }\r\n        // }\r\n\r\n        return NextResponse.json({ error: 'TTS Failed', details: error.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,6BAA6B;AAC7B,SAAS,gBAAgB,SAAiB,EAAE,aAAqB,KAAK,EAAE,cAAsB,CAAC,EAAE,gBAAwB,EAAE;IACvH,MAAM,SAAS,OAAO,KAAK,CAAC;IAC5B,OAAO,KAAK,CAAC,QAAQ;IACrB,OAAO,aAAa,CAAC,KAAK,WAAW;IACrC,OAAO,KAAK,CAAC,QAAQ;IACrB,OAAO,KAAK,CAAC,QAAQ;IACrB,OAAO,aAAa,CAAC,IAAI;IACzB,OAAO,aAAa,CAAC,GAAG;IACxB,OAAO,aAAa,CAAC,aAAa;IAClC,OAAO,aAAa,CAAC,YAAY;IACjC,OAAO,aAAa,CAAC,aAAa,cAAc,CAAC,gBAAgB,CAAC,GAAG;IACrE,OAAO,aAAa,CAAC,cAAc,CAAC,gBAAgB,CAAC,GAAG;IACxD,OAAO,aAAa,CAAC,eAAe;IACpC,OAAO,KAAK,CAAC,QAAQ;IACrB,OAAO,aAAa,CAAC,WAAW;IAChC,OAAO;AACX;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI,OAAO;IACX,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO,KAAK,IAAI;QAChB,IAAI,CAAC,MAAM,OAAO,uMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;QAE9E,MAAM;QACN;;QAEA,MAAM,QAAQ,IAAI,6OAAkB,CAAC;QACrC,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAA+B;QAE/E,QAAQ,GAAG,CAAC,CAAC,4CAA4C,EAAE,KAAK,SAAS,CAAC,GAAG,IAAI,IAAI,CAAC;QAEtF,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;YACvC,UAAU;gBAAC;oBAAE,MAAM;oBAAQ,OAAO;wBAAC;4BAAE;wBAAK;qBAAE;gBAAC;aAAE;YAC/C,kBAAkB;gBACd,oBAAoB;oBAAC;iBAAQ;gBAC7B,cAAc;oBAAE,aAAa;wBAAE,qBAAqB;4BAAE,WAAW;wBAAY;oBAAE;gBAAE;YACrF;QACJ;QAEA,MAAM,YAAY,OAAO,QAAQ,CAAC,UAAU,EAAE,CAAC,EAAE,EAAE,QAAQ,MAAM,KAAK,CAAC,IAAW,EAAE,UAAU;QAC9F,IAAI,WAAW,YAAY,MAAM;YAC7B,MAAM,UAAU,OAAO,IAAI,CAAC,UAAU,UAAU,CAAC,IAAI,EAAE;YACvD,MAAM,YAAY,OAAO,MAAM,CAAC;gBAAC,gBAAgB,QAAQ,MAAM;gBAAG;aAAQ;YAC1E,QAAQ,GAAG,CAAC,CAAC,qBAAqB,CAAC;YACnC,OAAO,uMAAY,CAAC,IAAI,CAAC;gBACrB,cAAc,UAAU,QAAQ,CAAC;gBACjC,UAAU;oBAAE,QAAQ;oBAAU,OAAO;gBAAY;YACrD;QACJ;QACA,MAAM,IAAI,MAAM;IACpB,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,uBAAuB,MAAM,OAAO;QAElD,+BAA+B;QAC/B,cAAc;QACd,yFAAyF;QACzF,YAAY;QACZ,kDAAkD;QAClD,0GAA0G;QAC1G,cAAc;QAEd,4BAA4B;QAC5B,+BAA+B;QAC/B,yEAAyE;QACzE,qDAAqD;QACrD,oBAAoB;QAEpB,qEAAqE;QACrE,0EAA0E;QAE1E,8BAA8B;QAC9B,sDAAsD;QACtD,yCAAyC;QACzC,gCAAgC;QAChC,2EAA2E;QAC3E,kBAAkB;QAClB,YAAY;QACZ,qCAAqC;QACrC,yEAAyE;QACzE,QAAQ;QACR,IAAI;QAEJ,OAAO,uMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAc,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC5F;AACJ"}}]
}