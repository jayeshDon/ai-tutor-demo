{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jayesh_naphade/.gemini/antigravity/scratch/ai_tutor_demo/components/ChatInterface.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { Mic, Square, ArrowLeft, Volume2, Video } from \"lucide-react\";\r\nimport 'regenerator-runtime/runtime';\r\nimport SpeechRecognition, { useSpeechRecognition } from 'react-speech-recognition';\r\n\r\ninterface ChatMessage {\r\n    role: \"user\" | \"model\";\r\n    parts: string;\r\n}\r\n\r\ninterface ChatInterfaceProps {\r\n    transcript: string;\r\n    videoUrl: string;\r\n    onBack: () => void;\r\n}\r\n\r\nexport default function ChatInterface({ transcript, videoUrl, onBack }: ChatInterfaceProps) {\r\n    const [history, setHistory] = useState<ChatMessage[]>([]);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [status, setStatus] = useState<\"idle\" | \"listening\" | \"processing\" | \"speaking\">(\"idle\");\r\n\r\n    const {\r\n        transcript: userTranscript,\r\n        listening,\r\n        resetTranscript,\r\n        browserSupportsSpeechRecognition\r\n    } = useSpeechRecognition();\r\n\r\n    // Silence detection logic\r\n    const [silenceDuration, setSilenceDuration] = useState(0);\r\n    const silenceTimerRef = useRef<NodeJS.Timeout | null>(null);\r\n    const isSendingRef = useRef(false); // Lock to prevent double sends\r\n    const SILENCE_THRESHOLD = 800; // 0.8s silence threshold for snappy response\r\n\r\n    // Reset silence timer on transcript update\r\n    useEffect(() => {\r\n        if (status === \"listening\" && userTranscript.trim()) {\r\n            setSilenceDuration(0);\r\n\r\n            if (silenceTimerRef.current) clearTimeout(silenceTimerRef.current);\r\n\r\n            // Start visual timer (update state every 100ms for UI)\r\n            const startTime = Date.now();\r\n            const intervalId = setInterval(() => {\r\n                const elapsed = Date.now() - startTime;\r\n                setSilenceDuration(elapsed);\r\n\r\n                if (elapsed >= SILENCE_THRESHOLD) {\r\n                    clearInterval(intervalId);\r\n                    // Trigger send\r\n                    if (!isSendingRef.current) {\r\n                        SpeechRecognition.stopListening();\r\n                        handleSend(userTranscript);\r\n                    }\r\n                }\r\n            }, 100);\r\n\r\n            silenceTimerRef.current = intervalId;\r\n\r\n            return () => {\r\n                clearInterval(intervalId);\r\n            };\r\n        }\r\n    }, [userTranscript, status]);\r\n\r\n    // Handle browser auto-stop (Network/Engine stop)\r\n    useEffect(() => {\r\n        if (!listening && status === \"listening\" && userTranscript.trim()) {\r\n            // Only send if we haven't already sent (lock check)\r\n            if (!isSendingRef.current) {\r\n                handleSend(userTranscript);\r\n            }\r\n        }\r\n    }, [listening, status, userTranscript]);\r\n\r\n\r\n    const audioRef = useRef<HTMLAudioElement | null>(null);\r\n    const ttsAbortControllerRef = useRef<AbortController | null>(null);\r\n\r\n    // Stop audio when user starts speaking (Barge-in)\r\n    useEffect(() => {\r\n        // If listening and ANY text is detected (even 1 char), stop audio immediately\r\n        if (listening && userTranscript && isPlaying) {\r\n            console.log(\"Barge-in triggered: Stopping audio\");\r\n\r\n            // 1. Stop Audio Element\r\n            if (audioRef.current) {\r\n                audioRef.current.pause();\r\n                audioRef.current.currentTime = 0;\r\n            }\r\n\r\n            // 2. Stop Browser TTS\r\n            if (window.speechSynthesis.speaking) {\r\n                window.speechSynthesis.cancel();\r\n            }\r\n\r\n            // 3. Abort Pending TTS Request\r\n            if (ttsAbortControllerRef.current) {\r\n                ttsAbortControllerRef.current.abort();\r\n                ttsAbortControllerRef.current = null;\r\n            }\r\n\r\n            setIsPlaying(false);\r\n            // Ensure status remains listening\r\n            if (status !== \"listening\") setStatus(\"listening\");\r\n        }\r\n    }, [listening, userTranscript, isPlaying, status]);\r\n\r\n    const handleMicToggle = () => {\r\n        if (listening) {\r\n            SpeechRecognition.stopListening();\r\n            if (userTranscript.trim() && !isSendingRef.current) {\r\n                handleSend(userTranscript);\r\n            } else {\r\n                setStatus(\"idle\");\r\n            }\r\n        } else {\r\n            // Stop any playing audio when mic is manually activated\r\n            if (audioRef.current) {\r\n                audioRef.current.pause();\r\n                audioRef.current.currentTime = 0;\r\n                setIsPlaying(false);\r\n            }\r\n            // Stop browser TTS\r\n            if (window.speechSynthesis.speaking) {\r\n                window.speechSynthesis.cancel();\r\n            }\r\n            resetTranscript();\r\n            setSilenceDuration(0);\r\n            isSendingRef.current = false; // Reset lock\r\n            setStatus(\"listening\");\r\n            SpeechRecognition.startListening({ continuous: true });\r\n        }\r\n    };\r\n\r\n    const handleSend = async (text: string) => {\r\n        if (!text.trim() || isSendingRef.current) return;\r\n\r\n        isSendingRef.current = true; // Set lock\r\n        setStatus(\"processing\");\r\n\r\n        // Stop any existing audio\r\n        if (audioRef.current) {\r\n            audioRef.current.pause();\r\n            audioRef.current.currentTime = 0;\r\n            setIsPlaying(false);\r\n        }\r\n\r\n        const newHistory = [...history, { role: \"user\" as const, parts: text }];\r\n        setHistory(newHistory);\r\n\r\n        // Reset transcript immediately to prevent barge-in from triggering on the sent message\r\n        resetTranscript();\r\n        setSilenceDuration(0);\r\n\r\n        try {\r\n            const res = await fetch(\"/api/chat\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ history: newHistory, message: text, transcript }),\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (!res.ok) {\r\n                const errorMsg = data.error || \"Failed to get response\";\r\n                if (res.status === 429) {\r\n                    alert(\"Too many requests! The AI is busy. Please wait a moment and try again.\");\r\n                } else if (res.status === 500) {\r\n                    alert(`Server Error: ${data.details || errorMsg}`);\r\n                } else {\r\n                    alert(`Error: ${errorMsg}`);\r\n                }\r\n                throw new Error(errorMsg);\r\n            }\r\n\r\n            const aiResponseText = data.response;\r\n            const updatedHistory = [...newHistory, { role: \"model\" as const, parts: aiResponseText }];\r\n            setHistory(updatedHistory);\r\n\r\n            // Play TTS\r\n            await playTTS(aiResponseText);\r\n\r\n        } catch (error) {\r\n            console.error(\"Error getting response:\", error);\r\n            setStatus(\"idle\");\r\n        }\r\n    };\r\n\r\n    const playTTS = async (text: string) => {\r\n        // Stop any currently playing audio\r\n        if (audioRef.current) {\r\n            audioRef.current.pause();\r\n            audioRef.current.currentTime = 0;\r\n        }\r\n\r\n        // Stop browser TTS if playing\r\n        if (window.speechSynthesis.speaking) {\r\n            window.speechSynthesis.cancel();\r\n        }\r\n\r\n        // Abort any pending TTS fetch\r\n        if (ttsAbortControllerRef.current) {\r\n            ttsAbortControllerRef.current.abort();\r\n        }\r\n\r\n        // Create new controller for this request\r\n        const controller = new AbortController();\r\n        ttsAbortControllerRef.current = controller;\r\n\r\n        setStatus(\"speaking\"); // Set to speaking immediately to show activity\r\n        setIsPlaying(true); // Mark as playing so barge-in can trigger cancellation\r\n\r\n        try {\r\n            const res = await fetch(\"/api/tts\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ text }),\r\n                signal: controller.signal, // Link signal\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            // Check for quota/rate limit errors - fallback to browser TTS\r\n            if (!res.ok && (res.status === 429 || data.error === \"TTS Failed\")) {\r\n                console.warn(\"Gemini TTS quota exceeded, using browser TTS fallback\");\r\n                playBrowserTTS(text);\r\n                return;\r\n            }\r\n\r\n            if (!res.ok) throw new Error(\"TTS request failed\");\r\n\r\n            // Check if we were aborted while waiting (double check)\r\n            if (controller.signal.aborted) return;\r\n\r\n            if (data.audioContent) {\r\n                const audio = new Audio(`data:audio/wav;base64,${data.audioContent}`);\r\n                audioRef.current = audio;\r\n\r\n                audio.onended = () => {\r\n                    setIsPlaying(false);\r\n                    setStatus(\"idle\");\r\n                };\r\n\r\n                // One last check before playing\r\n                if (!controller.signal.aborted) {\r\n                    await audio.play();\r\n                }\r\n            }\r\n        } catch (err: any) {\r\n            if (err.name === 'AbortError') {\r\n                console.log(\"TTS playback aborted by user action\");\r\n            } else {\r\n                console.error(\"Gemini TTS Error, falling back to browser TTS:\", err);\r\n                // Fallback to browser TTS on any error\r\n                playBrowserTTS(text);\r\n            }\r\n            // Only reset if we are the active controller\r\n            if (ttsAbortControllerRef.current === controller) {\r\n                ttsAbortControllerRef.current = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    // Browser TTS Fallback (instant, unlimited, free)\r\n    const playBrowserTTS = (text: string) => {\r\n        console.log(\"[Browser TTS] Using native speech synthesis\");\r\n\r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n\r\n        // Configure voice settings\r\n        utterance.rate = 1.1; // Slightly faster for snappier responses\r\n        utterance.pitch = 1.0;\r\n        utterance.volume = 1.0;\r\n\r\n        // Try to use a good English voice if available\r\n        const voices = window.speechSynthesis.getVoices();\r\n        const preferredVoice = voices.find(v =>\r\n            v.lang.startsWith('en') && (v.name.includes('Google') || v.name.includes('Natural'))\r\n        ) || voices.find(v => v.lang.startsWith('en-IN'));\r\n\r\n        if (preferredVoice) {\r\n            utterance.voice = preferredVoice;\r\n        }\r\n\r\n        utterance.onend = () => {\r\n            setIsPlaying(false);\r\n            setStatus(\"idle\");\r\n        };\r\n\r\n        utterance.onerror = (err) => {\r\n            console.error(\"Browser TTS error:\", err);\r\n            setIsPlaying(false);\r\n            setStatus(\"idle\");\r\n        };\r\n\r\n        window.speechSynthesis.speak(utterance);\r\n    };\r\n\r\n    if (!browserSupportsSpeechRecognition) {\r\n        return <div className=\"text-white\">Browser does not support speech recognition.</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-screen bg-slate-900 text-white\">\r\n            {/* Header */}\r\n            <div className=\"p-4 border-b border-slate-800 flex items-center justify-between bg-slate-900/50 backdrop-blur-md sticky top-0 z-10\">\r\n                <button onClick={onBack} className=\"p-2 hover:bg-slate-800 rounded-full transition-colors\">\r\n                    <ArrowLeft className=\"w-6 h-6\" />\r\n                </button>\r\n                <h1 className=\"text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent\">\r\n                    AI Tutor\r\n                </h1>\r\n                <div className=\"w-10\" /> {/* Spacer */}\r\n            </div>\r\n\r\n            {/* Main Content Area */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-6\">\r\n\r\n                {/* Video Player (Compact) */}\r\n                <div className=\"aspect-video bg-black rounded-lg overflow-hidden border border-slate-800 shadow-lg max-w-2xl mx-auto\">\r\n                    <iframe\r\n                        width=\"100%\"\r\n                        height=\"100%\"\r\n                        src={`https://www.youtube.com/embed/${(() => {\r\n                            const match = videoUrl.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?|shorts)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/);\r\n                            return match ? match[1] : '';\r\n                        })()}`}\r\n                        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n                        allowFullScreen\r\n                        className=\"w-full h-full\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Chat History */}\r\n                <div className=\"space-y-4 max-w-2xl mx-auto pb-32\">\r\n                    {history.map((msg, idx) => (\r\n                        <motion.div\r\n                            key={idx}\r\n                            initial={{ opacity: 0, y: 10 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            className={`flex ${msg.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\r\n                        >\r\n                            <div className={`max-w-[80%] p-4 rounded-2xl ${msg.role === \"user\"\r\n                                ? \"bg-blue-600 text-white rounded-tr-none\"\r\n                                : \"bg-slate-800 text-slate-200 rounded-tl-none border border-slate-700\"\r\n                                }`}>\r\n                                {msg.parts}\r\n                            </div>\r\n                        </motion.div>\r\n                    ))}\r\n\r\n                    {/* Live Transcript / Processing Indicator */}\r\n                    {(listening || status === \"processing\" || status === \"speaking\") && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            className=\"flex justify-center\"\r\n                        >\r\n                            <div className=\"bg-slate-800/80 backdrop-blur px-6 py-3 rounded-full border border-slate-700 flex items-center gap-3\">\r\n                                {status === \"listening\" && (\r\n                                    <>\r\n                                        <div className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\" />\r\n                                        <span className=\"text-slate-300 text-sm\">\r\n                                            {userTranscript || \"Listening...\"}\r\n                                        </span>\r\n                                        {/* Visual Silence Timer */}\r\n                                        <div className=\"w-16 h-1 bg-slate-700 rounded-full overflow-hidden ml-2\">\r\n                                            <motion.div\r\n                                                className=\"h-full bg-blue-500\"\r\n                                                initial={{ width: \"0%\" }}\r\n                                                animate={{ width: `${Math.min((silenceDuration / SILENCE_THRESHOLD) * 100, 100)}%` }}\r\n                                                transition={{ duration: 0.1 }}\r\n                                            />\r\n                                        </div>\r\n                                    </>\r\n                                )}\r\n                                {status === \"processing\" && (\r\n                                    <>\r\n                                        <div className=\"flex gap-1\">\r\n                                            <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: \"0ms\" }} />\r\n                                            <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: \"150ms\" }} />\r\n                                            <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: \"300ms\" }} />\r\n                                        </div>\r\n                                        <span className=\"text-slate-300 text-sm\">Thinking...</span>\r\n                                    </>\r\n                                )}\r\n                                {status === \"speaking\" && (\r\n                                    <>\r\n                                        <Volume2 className=\"w-4 h-4 text-green-400 animate-pulse\" />\r\n                                        <span className=\"text-slate-300 text-sm\">Speaking...</span>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        </motion.div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div className=\"p-6 bg-slate-900/80 backdrop-blur-lg border-t border-slate-800 fixed bottom-0 w-full\">\r\n                <div className=\"max-w-2xl mx-auto flex justify-center items-center gap-6\">\r\n                    <button\r\n                        onClick={handleMicToggle}\r\n                        className={`p-6 rounded-full transition-all duration-300 shadow-xl ${listening\r\n                            ? \"bg-red-500 hover:bg-red-600 shadow-red-500/30 scale-110\"\r\n                            : \"bg-blue-600 hover:bg-blue-500 shadow-blue-600/30\"\r\n                            }`}\r\n                    >\r\n                        {listening ? (\r\n                            <Square className=\"w-8 h-8 text-white fill-current\" />\r\n                        ) : (\r\n                            <Mic className=\"w-8 h-8 text-white\" />\r\n                        )}\r\n                    </button>\r\n\r\n                    {/* Status Text */}\r\n                    <div className=\"absolute bottom-2 text-xs text-slate-500\">\r\n                        {status === \"idle\" && \"Tap to speak\"}\r\n                        {status === \"listening\" && \"Listening...\"}\r\n                        {status === \"processing\" && \"Processing...\"}\r\n                        {status === \"speaking\" && \"Tap mic to interrupt\"}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 621, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jayesh_naphade/.gemini/antigravity/scratch/ai_tutor_demo/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Mic, MicOff, Play, Loader2, Volume2 } from \"lucide-react\";\nimport ChatInterface from \"@/components/ChatInterface\";\n\nexport default function Home() {\n  const [videoUrl, setVideoUrl] = useState(\"\");\n  const [transcript, setTranscript] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isChatActive, setIsChatActive] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const handleStart = async () => {\n    if (!videoUrl) return;\n    setIsLoading(true);\n    setError(\"\");\n\n    try {\n      const res = await fetch(\"/api/transcript\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ url: videoUrl }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        throw new Error(data.error || \"Failed to fetch transcript\");\n      }\n\n      if (data.transcriptMissing) {\n        console.warn(data.warning);\n        // Optional: You could set a UI warning state here\n        // setError(data.warning); // Don't set error as it blocks the UI, maybe a toast?\n        // For now, we just proceed. The ChatInterface handles null transcript.\n      }\n\n      setTranscript(data.transcript || \"\"); // Ensure it's a string or null, but state is initialized as string.\n      // If null, we pass empty string? API expects null or string.\n      // Let's pass null if missing to be explicit, but state is string.\n      // Actually, let's just pass \"\" if null, and Chat API checks `if (transcript)`. Empty string is falsy.\n\n      setIsChatActive(true);\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <main className=\"min-h-screen bg-slate-950 text-slate-100 flex flex-col items-center justify-center p-4 overflow-hidden relative\">\n      {/* Background Gradients */}\n      <div className=\"absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none\">\n        <div className=\"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-600/20 rounded-full blur-[100px]\" />\n        <div className=\"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-600/20 rounded-full blur-[100px]\" />\n      </div>\n\n      <div className=\"z-10 w-full max-w-4xl\">\n        <AnimatePresence mode=\"wait\">\n          {!isChatActive ? (\n            <motion.div\n              key=\"landing\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -20 }}\n              className=\"flex flex-col items-center text-center space-y-8\"\n            >\n              <div className=\"space-y-4\">\n                <h1 className=\"text-5xl md:text-7xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400\">\n                  AI Video Tutor\n                </h1>\n                <p className=\"text-xl text-slate-400 max-w-2xl mx-auto\">\n                  Have a live voice conversation with any YouTube video.\n                  <br />\n                  Just paste the link and start learning.\n                </p>\n              </div>\n\n              <div className=\"w-full max-w-xl space-y-4\">\n                <div className=\"relative group\">\n                  <div className=\"absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg blur opacity-75 group-hover:opacity-100 transition duration-1000 group-hover:duration-200\" />\n                  <input\n                    type=\"text\"\n                    placeholder=\"Paste YouTube URL here...\"\n                    value={videoUrl}\n                    onChange={(e) => setVideoUrl(e.target.value)}\n                    className=\"relative w-full bg-slate-900 border border-slate-700 text-white placeholder-slate-500 rounded-lg px-6 py-4 focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-lg\"\n                  />\n                </div>\n\n                <div className=\"flex justify-center\">\n                  <button\n                    onClick={() => setVideoUrl(\"https://www.youtube.com/watch?v=kqtD5dpn9C8\")}\n                    className=\"text-sm text-slate-500 hover:text-blue-400 transition-colors underline\"\n                  >\n                    Try a Demo Video (Python Tutorial)\n                  </button>\n                </div>\n\n                {error && (\n                  <p className=\"text-red-400 text-sm\">{error}</p>\n                )}\n\n                <button\n                  onClick={handleStart}\n                  disabled={isLoading || !videoUrl}\n                  className=\"w-full bg-white text-slate-900 font-bold py-4 rounded-lg hover:bg-slate-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2\"\n                >\n                  {isLoading ? (\n                    <>\n                      <Loader2 className=\"animate-spin\" />\n                      <span>Processing Video...</span>\n                    </>\n                  ) : (\n                    <>\n                      <Play className=\"w-5 h-5 fill-current\" />\n                      <span>Start Session</span>\n                    </>\n                  )}\n                </button>\n              </div>\n            </motion.div>\n          ) : (\n            <ChatInterface\n              transcript={transcript}\n              videoUrl={videoUrl}\n              onBack={() => setIsChatActive(false)}\n            />\n          )}\n        </AnimatePresence>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;;;AALA;;;;;AAOe,SAAS;;IACtB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gOAAQ,EAAC;IACzC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gOAAQ,EAAC;IAC7C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gOAAQ,EAAC;IAC3C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,gOAAQ,EAAC;IACjD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,gOAAQ,EAAC;IAEnC,MAAM,cAAc;QAClB,IAAI,CAAC,UAAU;QACf,aAAa;QACb,SAAS;QAET,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,mBAAmB;gBACzC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,KAAK;gBAAS;YACvC;YAEA,MAAM,OAAO,MAAM,IAAI,IAAI;YAE3B,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAChC;YAEA,IAAI,KAAK,iBAAiB,EAAE;gBAC1B,QAAQ,IAAI,CAAC,KAAK,OAAO;YACzB,kDAAkD;YAClD,iFAAiF;YACjF,uEAAuE;YACzE;YAEA,cAAc,KAAK,UAAU,IAAI,KAAK,oEAAoE;YAC1G,6DAA6D;YAC7D,kEAAkE;YAClE,sGAAsG;YAEtG,gBAAgB;QAClB,EAAE,OAAO,KAAU;YACjB,SAAS,IAAI,OAAO;QACtB,SAAU;YACR,aAAa;QACf;IACF;IAEA,qBACE,oPAAC;QAAK,WAAU;;0BAEd,oPAAC;gBAAI,WAAU;;kCACb,oPAAC;wBAAI,WAAU;;;;;;kCACf,oPAAC;wBAAI,WAAU;;;;;;;;;;;;0BAGjB,oPAAC;gBAAI,WAAU;0BACb,cAAA,oPAAC,sQAAe;oBAAC,MAAK;8BACnB,CAAC,6BACA,oPAAC,8PAAM,CAAC,GAAG;wBAET,SAAS;4BAAE,SAAS;4BAAG,GAAG;wBAAG;wBAC7B,SAAS;4BAAE,SAAS;4BAAG,GAAG;wBAAE;wBAC5B,MAAM;4BAAE,SAAS;4BAAG,GAAG,CAAC;wBAAG;wBAC3B,WAAU;;0CAEV,oPAAC;gCAAI,WAAU;;kDACb,oPAAC;wCAAG,WAAU;kDAA4G;;;;;;kDAG1H,oPAAC;wCAAE,WAAU;;4CAA2C;0DAEtD,oPAAC;;;;;4CAAK;;;;;;;;;;;;;0CAKV,oPAAC;gCAAI,WAAU;;kDACb,oPAAC;wCAAI,WAAU;;0DACb,oPAAC;gDAAI,WAAU;;;;;;0DACf,oPAAC;gDACC,MAAK;gDACL,aAAY;gDACZ,OAAO;gDACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;gDAC3C,WAAU;;;;;;;;;;;;kDAId,oPAAC;wCAAI,WAAU;kDACb,cAAA,oPAAC;4CACC,SAAS,IAAM,YAAY;4CAC3B,WAAU;sDACX;;;;;;;;;;;oCAKF,uBACC,oPAAC;wCAAE,WAAU;kDAAwB;;;;;;kDAGvC,oPAAC;wCACC,SAAS;wCACT,UAAU,aAAa,CAAC;wCACxB,WAAU;kDAET,0BACC;;8DACE,oPAAC,sRAAO;oDAAC,WAAU;;;;;;8DACnB,oPAAC;8DAAK;;;;;;;yEAGR;;8DACE,oPAAC,oQAAI;oDAAC,WAAU;;;;;;8DAChB,oPAAC;8DAAK;;;;;;;;;;;;;;;;;;;;uBAvDV;;;;6CA8DN,oPAAC,iMAAa;wBACZ,YAAY;wBACZ,UAAU;wBACV,QAAQ,IAAM,gBAAgB;;;;;;;;;;;;;;;;;;;;;;AAO5C;GAjIwB;KAAA"}}]
}